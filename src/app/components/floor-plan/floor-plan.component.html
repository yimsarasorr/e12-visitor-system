<div [class.fullscreen]="isFullscreen" class="floor-plan-wrapper">
  <div class="floor-plan-stage">
    <canvas #canvas></canvas>
  </div>

  <div class="floor-plan-toolbar" (click)="$event.stopPropagation()">
    <p-button
      icon="pi pi-bars"
      (click)="onMenuToggleClick()"
      styleClass="p-button-secondary p-button-sm menu-toggle-button"
      ariaLabel="Toggle navigation"
    ></p-button>

    <div class="floor-indicator" *ngIf="floorData">
      <span class="floor-indicator__number">{{ floorData.floor }}</span>
      <div class="floor-indicator__label">
        <span class="floor-indicator__title">{{ floorData.floorName || ('ชั้น ' + floorData.floor) }}</span>
        <span class="floor-indicator__subtitle">Active Floor</span>
      </div>
    </div>

    <div class="access-terminal">
      <span class="terminal-title">Face Access</span>
      <div class="terminal-buttons">
        <p-button
          (click)="interaction.simulateAuthentication(-1)"
          label="-1"
          styleClass="p-button-sm p-button-danger"
        ></p-button>
        <p-button
          (click)="interaction.simulateAuthentication(0)"
          label="0"
          styleClass="p-button-sm p-button-secondary"
        ></p-button>
        <p-button
          (click)="interaction.simulateAuthentication(1)"
          label="1"
          styleClass="p-button-sm p-button-success"
        ></p-button>
      </div>
    </div>

    <div class="view-toggle-container">
      </div>
  </div>

  <div class="info-display-container">
    <div *ngIf="interaction.currentZoneId$ | async as zoneId" class="zone-display">
      Zone: <strong>{{ zoneId }}</strong>
    </div>
    <div *ngIf="playerPositionDisplay$ | async as posDisplay" class="zone-display">
      Coords: <strong>{{ posDisplay }}</strong>
    </div>
  </div>

  <app-joystick></app-joystick>

  </div>

<p-dialog
  header="Details"
  [(visible)]="detailDialogVisible"
  (onHide)="interaction.closeDetail()"
  [modal]="true"
  appendTo="body"
  [style]="{ width: '50vw', 'max-width': '520px' }"
  [draggable]="false"
  [resizable]="false"
>
  <div *ngIf="interaction.selectedObject$ | async as selected" class="detail-content" (click)="$event.stopPropagation()">
    <div class="detail-header">
      <div>
        <h3>{{ selected.data?.name || selected.data?.id }}</h3>
        <p class="detail-subtitle">
          {{ getTypeLabel(selected.type) }} • ชั้น {{ selected.data?.floor ?? floorData?.floor }}
        </p>
      </div>
    </div>

    <ng-container [ngSwitch]="selected.type">
      <ng-container *ngSwitchCase="'door'">
        <div class="detail-section">
          <h4>Door Access</h4>
          <p><strong>Required Level:</strong> {{ selected.data.accessLevel }}</p>
          <p><strong>Your Level:</strong> {{ interaction.currentUserAccessLevel$ | async }}</p>
          <p><strong>Status:</strong>
            <ng-container *ngIf="interaction.currentUserAccessLevel$ | async as currentLevel">
              <span [ngClass]="currentLevel >= selected.data.accessLevel ? 'status-unlocked' : 'status-locked'">
                {{ currentLevel >= selected.data.accessLevel ? 'UNLOCKED' : 'LOCKED' }}
              </span>
            </ng-container>
          </p>
        </div>
      </ng-container>

      </ng-container>
  </div>
</p-dialog>