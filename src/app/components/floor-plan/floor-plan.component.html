<div [class.fullscreen]="isFullscreen" class="floor-plan-wrapper">

  <div class="view-toggle-container" (click)="$event.stopPropagation()">
    <p-button
      (click)="toggleFullscreen()"
      [icon]="isFullscreen ? 'pi pi-window-minimize' : 'pi pi-window-maximize'"
      [label]="isFullscreen ? 'Exit' : 'Fullscreen'"
      styleClass="p-button-sm"
    ></p-button>
    <p-button
      (click)="toggleView()"
      [label]="currentView === 'game' ? 'Top View' : 'Game View'"
      styleClass="p-button-sm p-button-secondary"
    ></p-button>
  </div>

  <div class="auth-controls" (click)="$event.stopPropagation()">
    <p-button
      (click)="simulateAuthentication(1)"
      label="Guest Access"
      styleClass="p-button-sm p-button-info"
    ></p-button>
    <p-button
      (click)="simulateAuthentication(2)"
      label="Staff Access"
      styleClass="p-button-sm p-button-success"
    ></p-button>
    <p-button
      (click)="simulateAuthentication(0)"
      label="Logout"
      styleClass="p-button-sm p-button-warning"
    ></p-button>
  </div>

  <canvas #canvas></canvas>

  <div class="info-display-container">
    <div *ngIf="currentZoneId" class="zone-display">
      Zone: <strong>{{ currentZoneId }}</strong>
    </div>
    <div *ngIf="playerPositionDisplay" class="zone-display">
      Coords: <strong>{{ playerPositionDisplay }}</strong>
    </div>
  </div>

  <div
    class="mobile-controls"
    (pointerdown)="disableOrbitControls($event)"
    (pointerup)="enableOrbitControls($event)"
  >
    <button class="control-btn up" (touchstart)="move($event, 'ArrowUp', true)" (touchend)="move($event, 'ArrowUp', false)">▲</button>
    <div class="horizontal-controls">
      <button class="control-btn left" (touchstart)="move($event, 'ArrowLeft', true)" (touchend)="move($event, 'ArrowLeft', false)">◄</button>
      <button class="control-btn down" (touchstart)="move($event, 'ArrowDown', true)" (touchend)="move($event, 'ArrowDown', false)">▼</button>
      <button class="control-btn right" (touchstart)="move($event, 'ArrowRight', true)" (touchend)="move($event, 'ArrowRight', false)">►</button>
    </div>
  </div>
</div>

<p-dialog
  header="Details"
  [(visible)]="isDetailDialogVisible"
  (onHide)="onDialogHide()"
  [modal]="true"
  [style]="{ width: '50vw', 'max-width': '500px' }"
  [draggable]="false"
  [resizable]="false"
>
  <div *ngIf="selectedObject" (click)="$event.stopPropagation()">
    <ng-container *ngIf="selectedObject.type === 'floor'">
      <h3>{{ selectedObject.data.id }}</h3>
      <p><strong>Type:</strong> Area</p>
      <p><strong>Boundary:</strong></p>
      <ul>
        <li>Min: ({{ selectedObject.data.boundary.min.x }}, {{ selectedObject.data.boundary.min.y }})</li>
        <li>Max: ({{ selectedObject.data.boundary.max.x }}, {{ selectedObject.data.boundary.max.y }})</li>
      </ul>
    </ng-container>

    <ng-container *ngIf="selectedObject.type === 'door'">
        <h3>{{ selectedObject.data.id }}</h3>
        <p><strong>Type:</strong> Door</p>
        <p><strong>Required Access Level:</strong> {{ selectedObject.data.accessLevel }}</p>
        <p><strong>Your Access Level:</strong> {{ currentUserAccessLevel }}</p>
        <p><strong>Status:</strong>
            <span [ngClass]="currentUserAccessLevel >= selectedObject.data.accessLevel ? 'status-unlocked' : 'status-locked'">
                {{ currentUserAccessLevel >= selectedObject.data.accessLevel ? 'UNLOCKED' : 'LOCKED' }}
            </span>
        </p>
    </ng-container>

    <ng-container *ngIf="selectedObject.type === 'object'">
        <h3>{{ selectedObject.data.id }}</h3>
        <p><strong>Type:</strong> {{ selectedObject.data.type }}</p>
    </ng-container>
  </div>
</p-dialog>