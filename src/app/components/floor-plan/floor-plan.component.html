<div [class.fullscreen]="isFullscreen" class="floor-plan-wrapper">
  <canvas #canvas></canvas>

  <div class="floor-plan-toolbar" (click)="$event.stopPropagation()">
    <div class="floor-indicator" *ngIf="floorData">
      <span class="floor-indicator__number">{{ floorData.floor }}</span>
      <div class="floor-indicator__label">
        <span class="floor-indicator__title">{{ floorData.floorName || ('ชั้น ' + floorData.floor) }}</span>
        <span class="floor-indicator__subtitle">Floorplan</span>
      </div>
    </div>

    <div class="toolbar-actions">
      <button
        pButton
        type="button"
        class="toolbar-button"
        [icon]="currentView === 'iso' ? 'pi pi-cube' : 'pi pi-map'"
        [label]="currentView === 'iso' ? 'มุมมองอาคาร' : 'มุมมองจากบน'"
        (click)="toggleView()"
      ></button>
      <button
        pButton
        type="button"
        class="toolbar-icon-button"
        [icon]="isFullscreen ? 'pi pi-compress' : 'pi pi-external-link'"
        (click)="toggleFullscreen()"
        [attr.aria-label]="isFullscreen ? 'ปิดโหมดเต็มหน้าจอ' : 'เปิดโหมดเต็มหน้าจอ'"
      ></button>
    </div>
  </div>

  <div class="info-display-container">
    <div class="zone-display" *ngIf="interaction.currentZoneId$ | async as zoneId">
      <i class="pi pi-map-marker"></i>
      <span>{{ zoneId }}</span>
    </div>
    <div class="zone-display" *ngIf="playerPositionDisplay$ | async as position">
      <i class="pi pi-compass"></i>
      <span>{{ position }}</span>
    </div>
  </div>

  <app-joystick></app-joystick>
</div>

<p-dialog
  header="รายละเอียดพื้นที่"
  [(visible)]="detailDialogVisible"
  (onHide)="interaction.closeDetail()"
  [modal]="true"
  appendTo="body"
  [style]="{ width: '48vw', 'max-width': '480px' }"
  [breakpoints]="{ '1200px': '60vw', '960px': '70vw', '640px': '92vw' }"
  [draggable]="false"
  [resizable]="false"
  styleClass="floor-detail-dialog"
>
  <div *ngIf="interaction.selectedObject$ | async as selected" class="detail-content" (click)="$event.stopPropagation()">
    <div class="detail-header">
      <h3>{{ selected.data?.name || selected.data?.id }}</h3>
      <p class="detail-subtitle">
        {{ selected.type | titlecase }} • ชั้น {{ selected.data?.floor ?? floorData?.floor }}
      </p>
    </div>

    <ng-container [ngSwitch]="selected.type">
      <div class="detail-section" *ngSwitchCase="'door'">
        <h4>สิทธิ์การเข้าใช้งาน</h4>
        <p>
          <strong>ระดับที่ต้องการ:</strong>
          {{ selected.data.accessLevel }}
        </p>
        <p>
          <strong>ระดับของคุณ:</strong>
          {{ interaction.currentUserAccessLevel$ | async }}
        </p>
        <p>
          <strong>สถานะ:</strong>
          <ng-container *ngIf="interaction.currentUserAccessLevel$ | async as currentLevel">
            <span [ngClass]="currentLevel >= selected.data.accessLevel ? 'status-unlocked' : 'status-locked'">
              {{ currentLevel >= selected.data.accessLevel ? 'UNLOCKED' : 'LOCKED' }}
            </span>
          </ng-container>
        </p>
      </div>
      <div class="detail-section" *ngSwitchDefault>
        <p class="detail-description">รอข้อมูลเพิ่มเติมสำหรับพื้นที่นี้</p>
      </div>
    </ng-container>
  </div>
</p-dialog>
