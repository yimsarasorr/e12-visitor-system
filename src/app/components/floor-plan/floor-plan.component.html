<div [class.fullscreen]="isFullscreen" class="floor-plan-wrapper">

  <div class="floor-plan-toolbar" (click)="$event.stopPropagation()">
    <div class="floor-indicator" *ngIf="floorData">
      <span class="floor-indicator__number">{{ floorData.floor }}</span>
      <div class="floor-indicator__label">
        <span class="floor-indicator__title">{{ floorData.floorName }}</span>
        <span class="floor-indicator__subtitle">E12 Engineering Hub</span>
      </div>
    </div>

    <div class="access-terminal">
      <span class="terminal-title">Face Access</span>
      <div class="terminal-buttons">
        <p-button
          (click)="simulateAuthentication(-1)"
          label="-1"
          styleClass="p-button-sm p-button-danger"
        ></p-button>
        <p-button
          (click)="simulateAuthentication(0)"
          label="0"
          styleClass="p-button-sm p-button-secondary"
        ></p-button>
        <p-button
          (click)="simulateAuthentication(1)"
          label="1"
          styleClass="p-button-sm p-button-success"
        ></p-button>
      </div>
    </div>

    <div class="view-toggle-container">
      <p-button
        (click)="toggleView()"
        [label]="currentView === 'iso' ? 'Top View' : 'ISO View'"
        styleClass="p-button-sm p-button-secondary"
      ></p-button>
      <p-button
        (click)="toggleFullscreen()"
        [icon]="isFullscreen ? 'pi pi-window-minimize' : 'pi pi-window-maximize'"
        [label]="isFullscreen ? 'Exit' : 'Fullscreen'"
        styleClass="p-button-sm"
      ></p-button>
    </div>
  </div>

  <canvas #canvas></canvas>

  <div class="info-display-container">
    <div *ngIf="currentZoneId" class="zone-display">
      Zone: <strong>{{ currentZoneId }}</strong>
    </div>
    <div *ngIf="playerPositionDisplay" class="zone-display">
      Coords: <strong>{{ playerPositionDisplay }}</strong>
    </div>
  </div>

  <div
    class="mobile-controls"
    (pointerdown)="disableOrbitControls($event)"
    (pointerup)="enableOrbitControls($event)"
  >
    <button class="control-btn up" (touchstart)="move($event, 'ArrowUp', true)" (touchend)="move($event, 'ArrowUp', false)">▲</button>
    <div class="horizontal-controls">
      <button class="control-btn left" (touchstart)="move($event, 'ArrowLeft', true)" (touchend)="move($event, 'ArrowLeft', false)">◄</button>
      <button class="control-btn down" (touchstart)="move($event, 'ArrowDown', true)" (touchend)="move($event, 'ArrowDown', false)">▼</button>
      <button class="control-btn right" (touchstart)="move($event, 'ArrowRight', true)" (touchend)="move($event, 'ArrowRight', false)">►</button>
    </div>
  </div>
</div>

<p-dialog
  header="Details"
  [(visible)]="isDetailDialogVisible"
  (onHide)="onDialogHide()"
  [modal]="true"
  [style]="{ width: '50vw', 'max-width': '500px' }"
  [draggable]="false"
  [resizable]="false"
>
  <div *ngIf="selectedObject" (click)="$event.stopPropagation()">
    <ng-container *ngIf="selectedObject.type === 'floor'">
      <h3>{{ selectedObject.data.id }}</h3>
      <p><strong>Type:</strong> Area</p>
      <p><strong>Boundary:</strong></p>
      <ul>
        <li>Min: ({{ selectedObject.data.boundary.min.x }}, {{ selectedObject.data.boundary.min.y }})</li>
        <li>Max: ({{ selectedObject.data.boundary.max.x }}, {{ selectedObject.data.boundary.max.y }})</li>
      </ul>
    </ng-container>

    <ng-container *ngIf="selectedObject.type === 'door'">
        <h3>{{ selectedObject.data.id }}</h3>
        <p><strong>Type:</strong> Door</p>
        <p><strong>Required Access Level:</strong> {{ selectedObject.data.accessLevel }}</p>
        <p><strong>Your Access Level:</strong> {{ currentUserAccessLevel }}</p>
        <p><strong>Status:</strong>
            <span [ngClass]="currentUserAccessLevel >= selectedObject.data.accessLevel ? 'status-unlocked' : 'status-locked'">
                {{ currentUserAccessLevel >= selectedObject.data.accessLevel ? 'UNLOCKED' : 'LOCKED' }}
            </span>
        </p>
    </ng-container>

    <ng-container *ngIf="selectedObject.type === 'object'">
        <h3>{{ selectedObject.data.id }}</h3>
        <p><strong>Type:</strong> {{ selectedObject.data.type }}</p>
    </ng-container>
  </div>
</p-dialog>
