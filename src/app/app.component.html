<div class="vms-layout">
  <p-toolbar styleClass="vms-header">
    <ng-template pTemplate="start">
      <div class="header-brand">
        <img src="assets/FastPass_Icon_1.png" alt="Fastpass" class="brand-logo" />
        <div class="brand-copy">
          <span class="brand-title">Fastpass</span>
          <span class="brand-subtitle">ระบบเข้าอาคาร</span>
        </div>
      </div>
    </ng-template>
    <ng-template pTemplate="end">
      <div class="header-actions">
        <button pButton pRipple type="button" class="p-button-rounded p-button-text header-action">
          <i class="pi pi-bell"></i>
        </button>
        <p-select 
          [options]="(availableUsers$ | async) ?? []"
          optionLabel="role_label" 
          [(ngModel)]="currentUser"
          (onChange)="onUserChange($event.value)"
          styleClass="role-selector"
          placeholder="เลือกผู้ใช้งาน"
          aria-label="เลือกผู้ใช้งานเพื่อทดสอบ"
        >
          <ng-template let-user pTemplate="selectedItem">
            <div class="flex align-items-center gap-2" *ngIf="user">
              <i [class]="user.is_staff ? 'pi pi-id-card' : 'pi pi-user'"></i>
              <div>{{ user.full_name }}</div>
            </div>
          </ng-template>
          <ng-template let-user pTemplate="item">
              <div class="flex align-items-center gap-2">
                  <i [class]="user.is_staff ? 'pi pi-id-card' : 'pi pi-user'"></i>
                  <div>{{ user.role_label }}</div>
              </div>
          </ng-template>
        </p-select>
      </div>
    </ng-template>
  </p-toolbar>

  <main class="vms-content">
    <!-- Map-only view: แสดงเฉพาะเมื่อ viewMode === 'map' -->
    <ng-container *ngIf="viewMode === 'map'">
      <app-map-view
        [buildingData]="buildingData"
        (buildingSelected)="onBuildingSelected($event)"
      ></app-map-view>
    </ng-container>
  </main>

  <ng-template #floorWorkspace>
    <div class="panel panel-right floor-plan-content">
      <!-- ...existing code... -->
    </div>
  </ng-template>

  <section
    *ngIf="isSheetVisible"
    class="access-bottom-sheet"
    [ngClass]="'sheet-state-' + sheetState"
    role="dialog"
    aria-modal="false"
  >
    <div
      class="bottom-sheet-header"
      (click)="onSheetHeaderTap()"
      (touchstart)="onGestureStart($event)"
      (mousedown)="onGestureStart($event)"
    >
      <div class="bottom-sheet-grabber"></div>
    </div>
    <div class="bottom-sheet-content">
      <app-access-list></app-access-list>
    </div>
  </section>

  <footer class="vms-footer">
    <button pButton pRipple type="button" class="p-button-text footer-button active">
      <i class="pi pi-compass"></i>
      <span>สำรวจ</span>
    </button>
    <button pButton pRipple type="button" class="p-button-text footer-button">
      <i class="pi pi-calendar"></i>
      <span>การจอง</span>
    </button>
    <button pButton pRipple type="button" class="p-button-text footer-button">
      <i class="pi pi-bookmark"></i>
      <span>บันทึกแล้ว</span>
    </button>
    <button pButton pRipple type="button" class="p-button-text footer-button">
      <i class="pi pi-clock"></i>
      <span>ล่าสุด</span>
    </button>
    <button pButton pRipple type="button" class="p-button-text footer-button">
      <i class="pi pi-user"></i>
      <span>โปรไฟล์</span>
    </button>
  </footer>
</div>
